{% extends 'base.html' %}

{% block content %}

<!-- Shopkeeper Header -->
<div class="shop-header">
    <div class="shop-logo">ðŸ›’ Dangi Traders - Shopkeeper</div>
    <div class="shop-nav">
        <a href="{% url 'customer_homepage' %}">Main Site</a>
        <a href="{% url 'shopkeeper_logout' %}" class="logout">Logout</a>
    </div>
</div>

<div class="shop-container">

    <!-- Stats Cards -->
    <div class="stats">
        <div class="card">
            <h3>â‚¹ {{ total_sales_today }}</h3>
            <p>Today's Sales</p>
        </div>
        <div class="card">
            <h3>{{ pending_orders }}</h3>
            <p>Pending Orders</p>
        </div>
        <div class="card">
            <h3>{{ low_stock_count }}</h3>
            <p>Low Stock Items</p>
        </div>
    </div>

    <!-- Orders Table -->
    <div class="table-box">
        <h2>Recent Orders</h2>
        <div class="table-responsive">
            <table>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Screenshot</th>
                    <th>Action</th>
                </tr>
                {% for order in recent_orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.customer_name }}</td>
                    <td>â‚¹ {{ order.total_amount }}</td>
                    <td>{{ order.status }}</td>
                    <td style="text-align:center;">
                        {% if order.screenshot %}
                            <a href="{{ order.screenshot.url }}" target="_blank">
                                <img src="{{ order.screenshot.url }}" alt="screenshot">
                            </a>
                        {% else %}
                            <span style="color:#888;">Not Uploaded</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if order.status == "Pending" %}
                            <a href="{% url 'confirm_order' order.id %}" class="btn-confirm">Confirm</a>
                        {% else %}
                            <span class="confirmed">Confirmed</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align:center;">No recent orders</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <!-- Inventory Table -->
    <div class="table-box">
        <h2>Inventory</h2>
        <a href="/shopkeeper_add_product/" class="btn-add">+ Add Product</a>
        <div class="table-responsive">
            <table>
                <tr>
                    <th>Product</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Description</th>
                    <th>Image</th>
                    <th>Action</th>
                </tr>
                {% for product in products %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td>{{ product.category }}</td>
                    <td>â‚¹ {{ product.price }}</td>
                    <td>{{ product.stock }}</td>
                    <td>{{ product.description }}</td>
                    <td>
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="product">
                        {% else %}
                            No Image
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'edit_product' product.id %}" class="btn-edit">Edit</a>
                        <a href="{% url 'delete_product' product.id %}" class="btn-delete">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

</div>

{% include "footer.html" %}

<style>
/* Header */
.shop-header {
    background:#2c3e50;
    padding:10px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
}
.shop-logo { color:white; font-size:18px; font-weight:bold; margin-bottom:5px; }
.shop-nav a { color:white; margin-right:15px; text-decoration:none; }
.shop-nav a.logout { color:#e74c3c; font-weight:bold; }

/* Container */
.shop-container { padding:20px; }

/* Stats */
.stats { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:20px; }
.stats .card {
    flex:1;
    min-width:200px;
    background:white;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
    text-align:center;
}
.stats .card h3 { margin:0; }

/* Tables */
.table-box {
    background:white;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
    margin-bottom:20px;
}
.table-box h2 { margin-top:0; }
.table-responsive { overflow-x:auto; }
table { width:100%; border-collapse:collapse; }
th, td {
    padding:10px;
    border:1px solid #ccc;
    text-align:center;
}
img { width:60px; height:60px; object-fit:cover; border-radius:5px; }

/* Buttons */
.btn-add {
    display:inline-block;
    margin:10px 0;
    background:#2ecc71;
    color:white;
    padding:8px 14px;
    border-radius:4px;
    text-decoration:none;
    font-weight:bold;
}
.btn-edit {
    background:#f39c12;
    color:white;
    padding:6px 12px;
    border-radius:4px;
    text-decoration:none;
    font-weight:bold;
    margin-right:5px;
}
.btn-delete {
    background:#e74c3c;
    color:white;
    padding:6px 12px;
    border-radius:4px;
    text-decoration:none;
    font-weight:bold;
}
.btn-confirm {
    background:#2ecc71;
    color:white;
    padding:6px 12px;
    border-radius:4px;
    text-decoration:none;
    font-weight:bold;
}
.confirmed { color:green; font-weight:bold; }

/* Mobile */
@media(max-width:768px){
    .shop-header { flex-direction:column; align-items:flex-start; }
    .shop-nav { margin-top:10px; }
    .stats { flex-direction:column; }
    table { font-size:14px; }
    img { width:40px; height:40px; }
}
</style>

{% endblock %}
